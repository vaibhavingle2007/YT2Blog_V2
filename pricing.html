<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Upgrade - YT2Blog Pro</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        /* Theme Toggle Button Styles - From Uiverse.io by CacaceRoberto */
        .theme-switch {
            position: relative;
            display: inline-block;
            width: 90px;
            height: 40px;
            border: 1px solid rgb(58, 58, 58);
            border-radius: 22px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-slider {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: black;
            border-radius: 20px;
            transition: 0.4s;
            overflow: hidden;
            z-index: 2;
        }

        .theme-slider:before {
            position: absolute;
            content: "";
            height: 30px;
            width: 30px;
            left: 4px;
            bottom: 5px;
            background-color: white;
            transition: 1s;
            border-radius: 50%;
            overflow: hidden;
        }

        .moons-hole {
            content: "";
            position: absolute;
            opacity: 1;
            transition: 1s;
        }

        .moon-hole {
            position: absolute;
            border-radius: 50%;
            transform: translateX(0px);
        }

        .moon-hole:nth-child(1) {
            background-color: rgb(85, 85, 85);
            height: 5px;
            width: 5px;
            top: 26px;
            left: 20px;
        }

        .moon-hole:nth-child(2) {
            background-color: rgb(85, 85, 85);
            height: 10px;
            width: 10px;
            top: 16px;
            left: 7px;
        }

        .moon-hole:nth-child(3) {
            background-color: rgb(85, 85, 85);
            height: 4px;
            width: 4px;
            top: 12px;
            left: 21px;
        }

        .theme-switch input:checked + .theme-slider {
            background-color: #62cff0;
        }

        .theme-switch input:checked + .theme-slider:before {
            transform: translateX(52px);
            background-color: orange;
        }

        .theme-switch input:checked + .theme-slider .moons-hole {
            transform: translateX(52px);
            opacity: 0;
        }

        .theme-stars {
            right: 6px;
            top: 0;
            bottom: 0;
            transition: 1s;
            transform: translateY(0px);
        }

        .theme-star {
            position: absolute;
            fill: white;
            animation: star-twinkle 2s infinite;
            opacity: 1;
        }

        .theme-star:nth-child(1) {
            top: 5px;
            right: 29px;
            width: 20px;
            animation-delay: 0.3s;
        }

        .theme-star:nth-child(2) {
            top: 18px;
            right: 9px;
            width: 15px;
        }

        .theme-star:nth-child(3) {
            top: 5px;
            right: 15px;
            width: 10px;
            animation-delay: 0.6s;
        }

        .theme-star:nth-child(4) {
            top: 26px;
            right: 28px;
            width: 12px;
            animation-delay: 0.9s;
        }

        .theme-star:nth-child(5) {
            top: 2px;
            right: 50px;
            width: 8px;
            animation-delay: 1.2s;
        }

        .theme-switch input:checked + .theme-slider .theme-stars {
            transform: translateY(-32px);
            opacity: 0;
        }

        @keyframes star-twinkle {
            0% {
                transform: scale(1);
            }

            40% {
                transform: scale(1.2);
            }

            80% {
                transform: scale(0.8);
            }

            100% {
                transform: scale(1);
            }
        }

        .theme-clouds {
            position: absolute;
            left: 6px;
            top: 0;
            bottom: 0;
            width: 20px;
            transition: 1s;
            transform: translateX(-55px);
        }

        .theme-black-clouds {
            position: absolute;
            left: 6px;
            top: 0;
            bottom: 0;
            width: 20px;
            transition: 1s;
            transform: translateX(-55px);
            opacity: 0;
            z-index: 0;
        }

        .theme-black-cloud {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #555;
            opacity: 60%;
            border-radius: 50%;
            animation: cloud-move 6s infinite;
            animation-delay: 1s;
        }

        .theme-black-cloud:nth-child(1) {
            top: 1px;
            right: 3px;
        }

        .theme-black-cloud:nth-child(2) {
            top: 15px;
            left: 9px;
        }

        .theme-black-cloud:nth-child(3) {
            top: 20px;
            left: 27px;
        }

        .theme-switch input:checked + .theme-slider .theme-black-clouds {
            transform: translateX(32px);
            opacity: 1;
        }

        .theme-cloud {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            z-index: 1;
            animation: cloud-move 6s infinite;
        }

        .theme-cloud:nth-child(1) {
            top: 0;
            height: 21px;
            width: 21px;
            right: 14px;
        }

        .theme-cloud:nth-child(2) {
            height: 25px;
            width: 25px;
            border-radius: 50%;
            top: 14px;
            right: 6px;
        }

        .theme-cloud:nth-child(3) {
            height: 23px;
            width: 23px;
            top: 28px;
            left: 4px;
        }

        .theme-cloud:nth-child(4) {
            top: 26px;
            left: 20px;
        }

        .theme-cloud:nth-child(5) {
            top: 30px;
            left: 30px;
        }

        .theme-cloud:nth-child(6) {
            top: 27px;
            left: 46px;
        }

        .theme-cloud:nth-child(7) {
            top: 31px;
            left: 58px;
        }

        .theme-switch input:checked + .theme-slider .theme-clouds {
            transform: translateX(32px);
            opacity: 1;
        }

        @keyframes cloud-move {
            0% {
                transform: translateX(-32px);
            }

            40% {
                transform: translateX(-36px);
            }

            80% {
                transform: translateX(-28px);
            }

            100% {
                transform: translateX(-32px);
            }
        }
    </style>
  </head>
  <body class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900">
    <header class="sticky top-0 z-40 border-b bg-white/80 backdrop-blur dark:bg-gray-900/80 dark:border-gray-700">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
        <a href="/" class="flex items-center gap-3">
          <div class="bg-red-600 p-2 rounded-lg">
            <i data-lucide="youtube" class="h-5 w-5 text-white"></i>
          </div>
          <div class="font-bold text-slate-900 dark:text-slate-100">YT2Blog <span class="text-xs font-semibold px-2 py-1 rounded bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 ml-2">PRO</span></div>
        </a>
        <div class="flex items-center gap-3">
          <span id="userBadge" class="text-sm text-slate-700 dark:text-slate-300 hidden"></span>
          <button id="authBtn" class="px-4 py-2 rounded-lg text-sm font-semibold bg-slate-900 text-white hover:bg-slate-800 dark:bg-slate-700 dark:hover:bg-slate-600">Sign in</button>
          <!-- Theme Toggle Button -->
          <label class="theme-switch">
            <input type="checkbox" id="themeToggle" />
            <span class="theme-slider">
              <div class="moons-hole">
                <div class="moon-hole"></div>
                <div class="moon-hole"></div>
                <div class="moon-hole"></div>
              </div>
              <div class="theme-black-clouds">
                <div class="theme-black-cloud"></div>
                <div class="theme-black-cloud"></div>
                <div class="theme-black-cloud"></div>
              </div>
              <div class="theme-clouds">
                <div class="theme-cloud"></div>
                <div class="theme-cloud"></div>
                <div class="theme-cloud"></div>
                <div class="theme-cloud"></div>
                <div class="theme-cloud"></div>
                <div class="theme-cloud"></div>
                <div class="theme-cloud"></div>
              </div>
              <div class="theme-stars">
                <svg class="theme-star" viewBox="0 0 20 20">
                  <path
                    d="M 0 10 C 10 10,10 10 ,0 10 C 10 10 , 10 10 , 10 20 C 10 10 , 10 10 , 20 10 C 10 10 , 10 10 , 10 0 C 10 10,10 10 ,0 10 Z"
                  ></path>
                </svg>
                <svg class="theme-star" viewBox="0 0 20 20">
                  <path
                    d="M 0 10 C 10 10,10 10 ,0 10 C 10 10 , 10 10 , 10 20 C 10 10 , 10 10 , 20 10 C 10 10 , 10 10 , 10 0 C 10 10,10 10 ,0 10 Z"
                  ></path>
                </svg>
                <svg class="theme-star" viewBox="0 0 20 20">
                  <path
                    d="M 0 10 C 10 10,10 10 ,0 10 C 10 10 , 10 10 , 10 20 C 10 10 , 10 10 , 20 10 C 10 10 , 10 10 , 10 0 C 10 10,10 10 ,0 10 Z"
                  ></path>
                </svg>
                <svg class="theme-star" viewBox="0 0 20 20">
                  <path
                    d="M 0 10 C 10 10,10 10 ,0 10 C 10 10 , 10 10 , 10 20 C 10 10 , 10 10 , 20 10 C 10 10 , 10 10 , 10 0 C 10 10,10 10 ,0 10 Z"
                  ></path>
                </svg>
                <svg class="theme-star" viewBox="0 0 20 20">
                  <path
                    d="M 0 10 C 10 10,10 10 ,0 10 C 10 10 , 10 10 , 10 20 C 10 10 , 10 10 , 20 10 C 10 10 , 10 10 , 10 0 C 10 10,10 10 ,0 10 Z"
                  ></path>
                </svg>
              </div>
            </span>
          </label>
        </div>
      </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
      <div class="flex flex-col gap-3 mb-10">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-slate-900 dark:text-slate-100">Upgrade your plan</h1>
        <p class="text-slate-600 dark:text-slate-400 max-w-2xl">Plans increase your daily credits and unlock higher throughput. Credits are consumed per blog generation.</p>
        <div id="creditsRow" class="text-sm text-slate-700 dark:text-slate-300 hidden">
          Current credits: <span class="font-semibold" id="creditsRemaining">-</span>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Free -->
        <div class="rounded-2xl border bg-white dark:bg-gray-800 p-6 shadow-sm dark:border-gray-700">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-bold text-slate-900 dark:text-slate-100">Free</h2>
            <span class="text-xs font-semibold px-2 py-1 rounded bg-slate-100 dark:bg-gray-700 text-slate-700 dark:text-slate-300">Default</span>
          </div>
          <div class="mt-4 text-3xl font-extrabold text-slate-900 dark:text-slate-100">₹0</div>
          <div class="text-sm text-slate-600 dark:text-slate-400 mt-1">5 credits/day</div>
          <ul class="mt-6 space-y-2 text-sm text-slate-700 dark:text-slate-300">
            <li class="flex gap-2"><i data-lucide="check" class="h-4 w-4 text-green-600"></i>Multi-language</li>
            <li class="flex gap-2"><i data-lucide="check" class="h-4 w-4 text-green-600"></i>All templates</li>
            <li class="flex gap-2"><i data-lucide="check" class="h-4 w-4 text-green-600"></i>Export to Markdown/HTML</li>
          </ul>
          <button disabled class="mt-6 w-full py-2.5 rounded-lg bg-slate-100 dark:bg-gray-700 text-slate-500 dark:text-slate-400 text-sm font-semibold">Current plan</button>
        </div>

        <!-- Starter -->
        <div class="rounded-2xl border bg-white dark:bg-gray-800 p-6 shadow-sm ring-2 ring-blue-600 dark:border-gray-700">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-bold text-slate-900 dark:text-slate-100">Starter</h2>
            <span class="text-xs font-semibold px-2 py-1 rounded bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">Best for creators</span>
          </div>
          <div class="mt-4 text-3xl font-extrabold text-slate-900 dark:text-slate-100">₹199<span class="text-base font-bold text-slate-600 dark:text-slate-400">/mo</span></div>
          <div class="text-sm text-slate-600 dark:text-slate-400 mt-1">50 credits/day</div>
          <ul class="mt-6 space-y-2 text-sm text-slate-700 dark:text-slate-300">
            <li class="flex gap-2"><i data-lucide="zap" class="h-4 w-4 text-blue-600"></i>Faster generation</li>
            <li class="flex gap-2"><i data-lucide="check" class="h-4 w-4 text-green-600"></i>Priority support</li>
            <li class="flex gap-2"><i data-lucide="check" class="h-4 w-4 text-green-600"></i>Higher limits</li>
          </ul>
          <button data-plan="starter" class="mt-6 w-full py-2.5 rounded-lg bg-blue-600 text-white text-sm font-semibold hover:bg-blue-700">Upgrade to Starter</button>
        </div>

        <!-- Pro -->
        <div class="rounded-2xl border bg-white dark:bg-gray-800 p-6 shadow-sm dark:border-gray-700">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-bold text-slate-900 dark:text-slate-100">Pro</h2>
            <span class="text-xs font-semibold px-2 py-1 rounded bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200">Teams</span>
          </div>
          <div class="mt-4 text-3xl font-extrabold text-slate-900 dark:text-slate-100">₹499<span class="text-base font-bold text-slate-600 dark:text-slate-400">/mo</span></div>
          <div class="text-sm text-slate-600 dark:text-slate-400 mt-1">200 credits/day</div>
          <ul class="mt-6 space-y-2 text-sm text-slate-700 dark:text-slate-300">
            <li class="flex gap-2"><i data-lucide="crown" class="h-4 w-4 text-purple-700 dark:text-purple-400"></i>Highest limits</li>
            <li class="flex gap-2"><i data-lucide="check" class="h-4 w-4 text-green-600"></i>Premium support</li>
            <li class="flex gap-2"><i data-lucide="check" class="h-4 w-4 text-green-600"></i>Roadmap access</li>
          </ul>
          <button data-plan="pro" class="mt-6 w-full py-2.5 rounded-lg bg-slate-900 dark:bg-slate-700 text-white text-sm font-semibold hover:bg-slate-800 dark:hover:bg-slate-600">Upgrade to Pro</button>
        </div>
      </div>

      <div class="mt-10 rounded-2xl border bg-white dark:bg-gray-800 p-6 text-sm text-slate-600 dark:text-slate-400 dark:border-gray-700">
        <div class="flex items-start gap-3">
          <i data-lucide="info" class="h-5 w-5 text-slate-500 mt-0.5"></i>
          <div>
            Payments aren’t fully wired yet in this repo. The upgrade buttons are hooked for Stripe-ready checkout; once you share your Stripe Price IDs, I’ll make purchases live.
          </div>
        </div>
      </div>
    </main>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
      import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

      // Theme management
      function initTheme() {
        const themeToggle = document.getElementById('themeToggle');
        const savedTheme = localStorage.getItem('theme') || 'light';
        
        // Apply saved theme
        if (savedTheme === 'dark') {
          document.documentElement.classList.add('dark');
          themeToggle.checked = true;
        } else {
          document.documentElement.classList.remove('dark');
          themeToggle.checked = false;
        }
        
        // Handle theme toggle
        themeToggle.addEventListener('change', (e) => {
          if (e.target.checked) {
            document.documentElement.classList.add('dark');
            localStorage.setItem('theme', 'dark');
          } else {
            document.documentElement.classList.remove('dark');
            localStorage.setItem('theme', 'light');
          }
        });
      }

      // Initialize theme before other scripts
      initTheme();

      lucide.createIcons();

      const API_BASE_URL = window.location.hostname === "localhost"
        ? "http://localhost:8000"
        : "https://ytblogs-production.up.railway.app";

      const authBtn = document.getElementById("authBtn");
      const userBadge = document.getElementById("userBadge");
      const creditsRow = document.getElementById("creditsRow");
      const creditsRemaining = document.getElementById("creditsRemaining");

      const tokenKey = "yt2blog_id_token";
      const getToken = () => localStorage.getItem(tokenKey);
      const setToken = (t) => localStorage.setItem(tokenKey, t);
      const clearToken = () => localStorage.removeItem(tokenKey);

      async function getPublicConfig() {
        const res = await fetch(`${API_BASE_URL}/api/public-config`);
        if (!res.ok) throw new Error("Failed to load public config");
        return await res.json();
      }

      async function authedFetch(url, options = {}) {
        const token = getToken();
        const headers = Object.assign({}, options.headers || {});
        if (token) headers["Authorization"] = `Bearer ${token}`;
        return fetch(url, Object.assign({}, options, { headers }));
      }

      const cfg = await getPublicConfig();
      const firebaseConfig = cfg.firebase || {};
      if (!firebaseConfig.apiKey || !firebaseConfig.projectId) {
        alert("Firebase is not configured on the server. Add FIREBASE_* values to .env and restart backend.");
      }
      const stripeConfigured = cfg.billing?.stripe_configured;

      const firebaseApp = initializeApp(firebaseConfig);
      const auth = getAuth(firebaseApp);
      const provider = new GoogleAuthProvider();

      authBtn.addEventListener("click", async () => {
        if (auth.currentUser) {
          await signOut(auth);
          return;
        }
        await signInWithPopup(auth, provider);
      });

      onAuthStateChanged(auth, async (user) => {
        if (!user) {
          clearToken();
          authBtn.textContent = "Sign in";
          userBadge.classList.add("hidden");
          creditsRow.classList.add("hidden");
          return;
        }

        const token = await user.getIdToken();
        setToken(token);

        authBtn.textContent = "Sign out";
        userBadge.textContent = user.email || user.displayName || "Signed in";
        userBadge.classList.remove("hidden");

        try {
          const res = await authedFetch(`${API_BASE_URL}/api/me/credits`);
          if (res.ok) {
            const data = await res.json();
            creditsRemaining.textContent = data.credits_remaining;
            creditsRow.classList.remove("hidden");
          }
        } catch (_) {}
      });

      document.querySelectorAll("button[data-plan]").forEach((btn) => {
        btn.addEventListener("click", async () => {
          if (!getToken()) {
            alert("Please sign in first.");
            return;
          }
          const planId = btn.dataset.plan;
          try {
            const res = await authedFetch(`${API_BASE_URL}/api/billing/checkout`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ plan_id: planId }),
            });
            const data = await res.json();
            if (!res.ok) {
              alert(data?.detail || "Failed to start checkout");
              return;
            }
            if (data.applied) {
              alert(`Plan '${planId}' activated for free (demo mode).`);
              // refresh credits display
              try {
                const creditsRes = await authedFetch(`${API_BASE_URL}/api/me/credits`);
                if (creditsRes.ok) {
                  const c = await creditsRes.json();
                  creditsRemaining.textContent = c.credits_remaining;
                  creditsRow.classList.remove("hidden");
                }
              } catch (_) {}
              return;
            }
            window.location.href = data.checkout_url;
          } catch (e) {
            alert("Failed to start checkout.");
          }
        });
      });

      // If Stripe is not configured, update CTA labels to show free activation
      if (!stripeConfigured) {
        document.querySelectorAll("button[data-plan]").forEach((btn) => {
          btn.textContent = `Activate ${btn.dataset.plan} (free for demo)`;
        });
      }
    </script>
  </body>
</html>

